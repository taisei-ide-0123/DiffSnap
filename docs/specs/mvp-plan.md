# DiffSnap MVP計画（Day 0-45）

**対象**: AIコーディングエージェント
**期間**: 45日間
**目標**: Chrome Web Store公開と初期ユーザー獲得

---

## 1. MVP範囲

### 1.1 実装する機能

**コア機能**:
- 5種類の画像検出（`<img>`, `<picture>`, `srcset`, CSS背景, `<canvas>`）
- 並列ダウンロード（グローバル8並列、ドメイン別2並列）
- 重複除外（SHA-256ハッシュ）
- ZIP一括ダウンロード
- プレビューUI

**Pro機能**:
- 差分検出エンジン（IndexedDB台帳管理）
- 新規画像のみ抽出
- 訪問履歴管理

**除外する機能（Phase 2以降）**:
- SVG、Data URL、WebGL抽出（3種類）
- OCR/全文検索
- タブ一括処理
- 後処理パイプライン（WebP変換等）
- Team/共有機能

### 1.2 テスト対象サイト（5サイト）

| # | サイト種別 | URL例 | 検証内容 | 期待枚数 |
|---|----------|------|---------|---------|
| 1 | EC | amazon.com/dp/XXX | 商品画像、srcset | ≥30 |
| 2 | ギャラリー | unsplash.com/s/photos/nature | 無限スクロール | ≥50 |
| 3 | ニュース | cnn.com | CSS背景、lazy-load | ≥40 |
| 4 | ドキュメント | wikipedia.org/wiki/XXX | 多様なフォーマット | ≥20 |
| 5 | 開発者 | github.com/user/repo | アイコン、スクショ | ≥15 |

---

## 2. 週次スケジュール

### Week 1-2 (Day 1-14): 基盤・検出エンジン

**セットアップ**:
- [ ] プロジェクト雛形作成（Vite + React + Tailwind）
- [ ] 品質チェックスクリプト設定（package.json scripts）
- [ ] scripts/ディレクトリ作成（4スクリプト）

**コア実装**:
- [ ] url-utils実装（正規化、recordID、重要パラメータ抽出）
- [ ] hasher実装（SHA-256）
- [ ] detector実装（5種類のみ: img, picture, srcset, CSS bg, canvas）
- [ ] 単体テスト（url-utils, hasher, detector基本）
- [ ] Content Script基本実装

### Week 3 (Day 15-21): 収集・並列制御

- [ ] lazy-loader実装（自動スクロール）
- [ ] 並列制御実装（グローバル8、ドメイン別2）
- [ ] Service Worker Keep-Alive実装
- [ ] collector実装（fetch + ハッシュ）
- [ ] メッセージング実装（Content ↔ Background）

### Week 4 (Day 22-28): UI・基本フロー

- [ ] Popup UI雛形（React）
- [ ] プレビューグリッド実装
- [ ] 進捗バー実装
- [ ] 状態管理（Zustand）
- [ ] エラーハンドリング基本

### Week 5 (Day 29-35): Pro機能・ZIP

- [ ] IndexedDB設定（idb）
- [ ] diff-engine実装（差分計算）
- [ ] filename実装（テンプレート評価）
- [ ] zipper実装（JSZip）
- [ ] ダウンロード実装

### Week 6 (Day 36-42): テスト・最適化

- [ ] E2E環境構築（Playwright）
- [ ] 5サイトテスト実装（Amazon, Unsplash, CNN, Wikipedia, GitHub）
- [ ] パフォーマンステスト（100枚ベンチマーク）
- [ ] メモリ最適化
- [ ] バグ修正

### Week 6-7 (Day 43-45): リリース準備

- [ ] ストア素材作成（スクリーンショット、アイコン、動画）
- [ ] プライバシーポリシー作成
- [ ] ユーザーガイド作成
- [ ] RELEASE.md作成（リリースチェックリスト）
- [ ] pnpm check:full 実行（全テスト）
- [ ] 手動QA（5サイトで動作確認）
- [ ] pnpm release 実行（ZIP生成）
- [ ] Chrome Web Store手動アップロード

---

## 3. MVP完了基準（Day 45）

### 3.1 技術指標

- [ ] 5サイト回帰テスト 85-90%検出率（MVP段階）
- [ ] 100枚処理 P50 ≤10秒、P95 ≤15秒
- [ ] プレビュー表示 P50 ≤1秒
- [ ] クラッシュ率 <2%（初期バージョン許容）

### 3.2 公開指標

- [ ] Chrome Web Store審査通過
- [ ] 初回公開完了
- [ ] ストア評価 ≥3.5（5レビュー以上）

### 3.3 ユーザー指標（初月目標）

- [ ] DAU 10-30（初月は認知不足）
- [ ] 週実行回数中央値 ≥1-2（習慣化前）
- [ ] NPS収集開始（サンプル10+、フィードバック重視）
- [ ] 初回実行→2回目実行 ≥40%（リテンション）

### 3.4 品質指標

- [ ] 致命的バグゼロ（データ損失、クラッシュループ等）
- [ ] サポート問い合わせ対応時間 <24時間
- [ ] ユーザーフィードバック収集フロー確立

---

## 4. 段階的実装戦略

### 4.1 検出エンジン

**MVP実装（5種類）**:
1. `<img>` - document.querySelectorAll('img')
2. `<picture>` - picture要素とsource走査
3. `srcset` - 最大解像度URL選択
4. CSS背景 - 主要セレクタのみ（最大500要素）
5. `<canvas>` - toDataURL変換

**Phase 2追加（3種類）**:
- SVG - 内部<image>抽出
- Data URL - Base64デコード
- WebGL - getImageData変換

### 4.2 並列制御

**MVP実装**:
- シンプルドメインカウント（hostname そのまま）
- グローバル8並列、ドメイン別2並列
- 基本リトライ（3回、指数バックオフ）

**Pro Phase改善**:
- CDNマッピング追加（主要50パターン）
- 適応的並列度調整
- 高度なリトライ戦略

### 4.3 テスト戦略

**MVP Phase**:
- 実サイトテスト（5サイト）
- CI/CDは許容的（失敗してもwarning）
- 手動QA重視

**Pro Phase**:
- モックサイト追加（HTML雛形、安定化）
- CI/CDブロッキング化
- スナップショットテスト導入

---

## 5. リスクと緩和策

### 5.1 技術リスク

| リスク | 確率 | 影響 | 緩和策 |
|-------|------|------|--------|
| E2Eテスト不安定 | 高 | 中 | モックサイト追加、リトライロジック |
| パフォーマンス未達 | 中 | 高 | 早期ベンチマーク、段階的最適化 |
| ストア審査遅延 | 中 | 中 | 早期提出（Day 40）、並行開発 |
| Service Worker制約 | 低 | 高 | MV3ベストプラクティス遵守 |

### 5.2 スコープクリープ対策

**完璧主義の回避**:
- MVP範囲外機能は即座に却下
- 「後で追加」リストを管理
- 5サイト85%検出率で公開（95%は不要）

**優先度マトリクス**:
```
必須（MVP必須）: 基本検出、並列DL、ZIP、プレビュー、差分
重要（MVP推奨）: エラーハンドリング、進捗UI、設定
有用（Phase 2）: SVG/Data URL、OCR、タブ一括
後回し（Phase 3）: Team、クラウド、API
```

---

## 6. 段階的品質基準

### 6.1 Week 2（Day 14）マイルストーン

- [ ] 検出エンジンが3種類（img, picture, srcset）で動作
- [ ] 単体テストカバレッジ ≥60%
- [ ] 手動テストで10枚画像取得成功

### 6.2 Week 4（Day 28）マイルストーン

- [ ] プレビューUIで画像一覧表示
- [ ] 進捗バー動作
- [ ] 1サイト（Amazon）で30枚取得成功

### 6.3 Week 6（Day 42）マイルストーン

- [ ] 5サイト全てで検出率 ≥80%
- [ ] 100枚処理が15秒以内
- [ ] 差分機能基本動作

---

## 7. 開発原則

### 7.1 スピード優先

- コード品質は60-70%で許容（リファクタは後）
- 実サイトテストで早期フィードバック
- 毎週1機能デモ可能な状態維持

### 7.2 シンプル実装

- ドメインカウントはhostnameそのまま（CDN判定は後）
- CSS背景は主要セレクタのみ（全要素走査しない）
- エラーは基本ログのみ（高度な回復は後）

### 7.3 段階的拡張

- 5種類検出 → 8種類（Phase 2）
- 5サイトテスト → 10サイト（安定期）
- 85%検出率 → 95%（最終目標）

---

## 8. 成功後の展開

### 8.1 Pro Phase移行条件（Day 46-90）

- [ ] MVP技術指標全達成
- [ ] ストア評価 ≥3.5
- [ ] DAU 20+安定
- [ ] 致命的バグ修正完了

### 8.2 Pro Phase追加機能

- SVG/Data URL/WebGL検出（+3種類）
- 10サイトテスト対応
- 検出率 90-95%
- Pro差別化機能強化（OCR等）

### 8.3 安定化Phase移行条件（Day 91-120）

- [ ] Pro契約 30-50件
- [ ] Free→Pro転換率 ≥2-3%
- [ ] Pro DAU 5-15
- [ ] NPS ≥30

---

## 付録: MVP実装ガイドライン

### A. コードスタイル

- TypeScript strict mode
- ESLint + Prettier
- コメントは「なぜ」を記述（「何」は不要）

### B. コミット規約

```
feat: 新機能
fix: バグ修正
perf: パフォーマンス改善
test: テスト追加
docs: ドキュメント
refactor: リファクタリング
```

### C. ブランチ戦略

- `main`: リリース可能状態
- `develop`: 開発統合
- `feature/*`: 機能開発
- Week末にdevelop→mainマージ

### D. レビュー基準

- 動作確認必須
- テスト追加（コア機能のみ）
- 破壊的変更は明示
- パフォーマンス影響評価
